$(document).ready(function(){function u(){var a,e;a=b;if(null===a&&(a=p,null===a))return;$("#thumbs img").each(function(){if(this.photo===a)return e=$(this),!1});if("undefined"!==typeof e){if(null!==b){var c=$("#album-view");c.stop().animate({scrollLeft:e.position().left+c.scrollLeft()-c.width()/2+e.width()/2},"slow")}else $("html, body").stop().animate({scrollTop:e.offset().top-$(window).height()/2+e.height()},"slow");null!==b&&($("#thumbs img").removeClass("current-thumb"),e.addClass("current-thumb"))}}
function n(a){return a[0]<a[1]?a[0]+"/"+a[1]:(a[0]/a[1]).toString()}function q(){var a,b;a=$("#photo");a.get(0)===this&&$(window).bind("resize",q);b=$("#photo-view");"100%"!==a.css("width")&&b.height()*a.attr("ratio")>b.width()?a.css("width","100%").css("height","auto").css("position","absolute").css("bottom",0):"100%"!==a.css("height")&&a.css("height","100%").css("width","auto").css("position","").css("bottom","")}function r(){var a,e,c;a=b.size[0];e=b.size[1];a>e?(e=e/a*h,a=h):(a=a/e*h,e=h);$(window).unbind("resize",
q);c=f.photoPath(d,b,h,!1);$("#photo").attr("width",a).attr("height",e).attr("ratio",b.size[0]/b.size[1]).attr("src",c).attr("alt",b.name).attr("title",b.date).load(q);$("head").append('<link rel="image_src" href="'+c+'" />');a=d.photos[0>l-1?d.photos.length-1:l-1];e=d.photos[l+1>=d.photos.length?0:l+1];$.preloadImages(f.photoPath(d,e,h,!1),f.photoPath(d,a,h,!1));e="#!/"+f.photoHash(d,e);$("#next-photo").attr("href",e);$("#next").attr("href",e);$("#back").attr("href","#!/"+f.photoHash(d,a));$("#original-link").attr("target",
"_blank").attr("href",f.originalPhotoPath(d,b));a="<table>";"undefined"!==typeof b.make&&(a+="<tr><td>Camera Maker</td><td>"+b.make+"</td></tr>");"undefined"!==typeof b.model&&(a+="<tr><td>Camera Model</td><td>"+b.model+"</td></tr>");"undefined"!==typeof b.date&&(a+="<tr><td>Time Taken</td><td>"+b.date+"</td></tr>");"undefined"!==typeof b.size&&(a+="<tr><td>Resolution</td><td>"+b.size[0]+" x "+b.size[1]+"</td></tr>");"undefined"!==typeof b.aperture&&(a+="<tr><td>Aperture</td><td> f/"+n(b.aperture)+
"</td></tr>");"undefined"!==typeof b.focalLength&&(a+="<tr><td>Focal Length</td><td>"+n(b.focalLength)+" mm</td></tr>");"undefined"!==typeof b.subjectDistanceRange&&(a+="<tr><td>Subject Distance Range</td><td>"+b.subjectDistanceRange+"</td></tr>");"undefined"!==typeof b.iso&&(a+="<tr><td>ISO</td><td>"+b.iso+"</td></tr>");"undefined"!==typeof b.sceneCaptureType&&(a+="<tr><td>Scene Capture Type</td><td>"+b.sceneCaptureType+"</td></tr>");"undefined"!==typeof b.exposureTime&&(a+="<tr><td>Exposure Time</td><td>"+
n(b.exposureTime)+" sec</td></tr>");"undefined"!==typeof b.exposureProgram&&(a+="<tr><td>Exposure Program</td><td>"+b.exposureProgram+"</td></tr>");"undefined"!==typeof b.exposureCompensation&&(a+="<tr><td>Exposure Compensation</td><td>"+n(b.exposureCompensation)+"</td></tr>");"undefined"!==typeof b.spectralSensitivity&&(a+="<tr><td>Spectral Sensitivity</td><td>"+b.spectralSensitivity+"</td></tr>");"undefined"!==typeof b.sensingMethod&&(a+="<tr><td>Sensing Method</td><td>"+b.sensingMethod+"</td></tr>");
"undefined"!==typeof b.lightSource&&(a+="<tr><td>Light Source</td><td>"+b.lightSource+"</td></tr>");"undefined"!==typeof b.flash&&(a+="<tr><td>Flash</td><td>"+b.flash+"</td></tr>");"undefined"!==typeof b.orientation&&(a+="<tr><td>Orientation</td><td>"+b.orientation+"</td></tr>");$("#metadata").html(a+"</table>");$("#album-view").addClass("photo-view-container");$("#subalbums").hide();$("#photo-view").show()}function v(a){403==a?($("#auth-text").fadeIn(1E3),$("#password").focus()):$("#error-text").fadeIn(2500);
$("#error-overlay").fadeTo(500,0.8);$("body, html").css("overflow","hidden")}function w(a,e,c){$("#error-text, #error-overlay, #auth-text").fadeOut(500);$("body, html").css("overflow","auto");$("#loading").hide();if(!(a===d&&e===b)){s=d;p=b;d=a;b=e;l=c;var j=c=a="",g,k;d.path.length?(g=d.path.split("/"),g.unshift(t)):g=[t];null!==b&&(c+=f.trimExtension(b.name));for(k=0;k<g.length;++k){if(k||null!==b)c+=" \u00ab ";k&&(j+="/"+g[k]);if(k<g.length-1||null!==b)a+='<a href="#!/'+(k?f.cachePath(j.substring(1)):
"")+'">';a+=g[k];c+=g[g.length-1-k];if(k<g.length-1||null!==b)a+="</a>",a+=" &raquo; "}null!==b&&(a+=f.trimExtension(b.name));$("#title").html(a);document.title=c;a=s!==d;var h,m;null===b&&null===p&&$("html, body").stop().animate({scrollTop:0},"slow");if(a){h=[];for(c=0;c<d.photos.length;++c)j=$('<a href="#!/'+f.photoHash(d,d.photos[c])+'"></a>'),g=$('<img title="'+f.trimExtension(d.photos[c].name)+'" alt="'+f.trimExtension(d.photos[c].name)+'" src="'+f.photoPath(d,d.photos[c],150,!0)+'" height="150" width="150" />'),
g.get(0).photo=d.photos[c],j.append(g),h.push(j),function(a,b,c){b.error(function(){h.splice(h.indexOf(a),1);a.remove();c.photos.splice(c.photos.indexOf(b.get(0).photo),1)})}(j,g,d);a=$("#thumbs");a.empty();a.append.apply(a,h);m=[];for(c=d.albums.length-1;0<=c;--c)j=$('<a href="#!/'+f.albumHash(d.albums[c])+'"></a>'),g=$('<div title="'+d.albums[c].date+'" class="album-button">'+d.albums[c].path+"</div>"),j.append(g),m.push(j),function(a,b,c,e){f.albumPhoto(b,function(a,b){c.css("background-image",
"url("+f.photoPath(a,b,150,!0)+")")},function(){a.albums.splice(d.albums.indexOf(b),1);e.remove();m.splice(m.indexOf(e),1)})}(d,d.albums[c],g,j);c=$("#subalbums");c.empty();c.append.apply(c,m);1<d.albums.length?c.insertBefore(a):a.insertBefore(c)}null===b&&($("#thumbs img").removeClass("current-thumb"),$("#album-view").removeClass("photo-view-container"),$("#subalbums").show(),$("#photo-view").hide());setTimeout(u,1);null!==e&&r()}}var d=null,b=null,l=-1,s=null,p=null,t=document.title,f=new PhotoFloat,
h=800;$(window).hashchange(function(){$("#loading").show();$("link[rel=image_src]").remove();f.parseHash(location.hash,w,v)});$(window).hashchange();$(document).keydown(function(a){return null===b?!0:39===a.keyCode?(window.location.href=$("#next").attr("href"),!1):37===a.keyCode?(window.location.href=$("#back").attr("href"),!1):!0});$(document).mousewheel(function(a,d){return null===b?!0:0>d?(window.location.href=$("#next").attr("href"),!1):0<d?(window.location.href=$("#back").attr("href"),!1):!0});
$("#photo-box").mouseenter(function(){$("#photo-links").stop().fadeTo("slow",0.5).css("display","inline")});$("#photo-box").mouseleave(function(){$("#photo-links").stop().fadeOut("slow")});$("#next, #back").mouseenter(function(){$(this).stop().fadeTo("slow",1)});$("#next, #back").mouseleave(function(){$(this).stop().fadeTo("slow",0.35)});$.support.fullscreen&&($("#fullscreen-divider").show(),$("#fullscreen").show().click(function(){$("#photo").fullScreen({callback:function(a){h=a?1024:800;r()}})}));
$("#metadata-link").click(function(){$("#metadata").is(":visible")?$("#metadata").stop().animate({height:0,paddingTop:0,paddingBottom:0},"slow",function(){$(this).hide();$("#metadata-link").text($("#metadata-link").text().replace("hide","show"))}):$("#metadata").stop().css("height",0).css("padding-top",0).css("padding-bottom",0).show().animate({height:$("#metadata > table").height(),paddingTop:3,paddingBottom:3},"slow",function(){$(this).css("height","auto");$("#metadata-link").text($("#metadata-link").text().replace("show",
"hide"))})});$("#auth-form").submit(function(){var a=$("#password");a.css("background-color","rgb(128, 128, 200)");f.authenticate(a.val(),function(b){a.val("");b?(a.css("background-color","rgb(200, 200, 200)"),$(window).hashchange()):a.css("background-color","rgb(255, 64, 64)")});return!1})});
