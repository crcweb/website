(function(){function b(){this.albumCache=[]}b.prototype.album=function(a,f,e){var c,d;"undefined"!==typeof a.photos&&null!==a.photos?f(a):(c="String"===Object.prototype.toString.call(a).slice(8,-1)?a:b.cachePath(a.parent.path+"/"+a.path),this.albumCache.hasOwnProperty(c)?f(this.albumCache[c]):(d=this,a={type:"GET",dataType:"json",url:"cache/"+c+".json",success:function(a){var b;for(b=0;b<a.albums.length;++b)a.albums[b].parent=a;for(b=0;b<a.photos.length;++b)a.photos[b].parent=a;d.albumCache[c]=a;
f(a)}},"undefined"!==typeof e&&null!==e&&(a.error=function(a){e(a.status)}),$.ajax(a)))};b.prototype.albumPhoto=function(a,b,e){var c,d;d=this;c=function(a){var g=Math.floor(Math.random()*(a.photos.length+a.albums.length));g>=a.photos.length?(g-=a.photos.length,d.album(a.albums[g],c,e)):b(a,a.photos[g])};"undefined"!==typeof a.photos&&null!==a.photos?c(a):this.album(a,c,e)};b.prototype.parseHash=function(a,f,e){var c,d;a=b.cleanHash(a);c=a.lastIndexOf("/");a.length?-1!==c&&c!==a.length-1?(d=a.substring(c+
1),a=a.substring(0,c)):d=null:(a=b.cachePath("root"),d=null);this.album(a,function(a){var c=-1;if(null!==d){for(c=0;c<a.photos.length;++c)if(b.cachePath(a.photos[c].name)===d){d=a.photos[c];break}c>=a.photos.length&&(d=null,c=-1)}f(a,d,c)},e)};b.prototype.authenticate=function(a,b){$.ajax({type:"GET",dataType:"text",url:"auth?username=photos&password="+a,success:function(){b(!0)},error:function(){b(!1)}})};b.cachePath=function(a){if(""===a)return"root";"/"===a.charAt(0)&&(a=a.substring(1));for(a=
a.replace(/ /g,"_").replace(/\//g,"-").replace(/\(/g,"").replace(/\)/g,"").replace(/#/g,"").replace(/&/g,"").replace(/,/g,"").replace(/\[/g,"").replace(/\]/g,"").replace(/"/g,"").replace(/'/g,"").replace(/_-_/g,"-").toLowerCase();-1!==a.indexOf("--");)a=a.replace(/--/g,"-");for(;-1!==a.indexOf("__");)a=a.replace(/__/g,"_");return a};b.photoHash=function(a,f){return b.albumHash(a)+"/"+b.cachePath(f.name)};b.albumHash=function(a){return"undefined"!==typeof a.photos&&null!==a.photos?b.cachePath(a.path):
b.cachePath(a.parent.path+"/"+a.path)};b.photoPath=function(a,f,e,c){e=c?e.toString()+"s":e.toString();a=b.cachePath(b.photoHash(a,f)+"_"+e+".jpg");0===a.indexOf("root-")&&(a=a.substring(5));return"cache/"+a};b.originalPhotoPath=function(a,b){return"albums/"+a.path+"/"+b.name};b.trimExtension=function(a){var b=a.lastIndexOf(".");return-1!==b?a.substring(0,b):a};b.cleanHash=function(a){for(;a.length;)if("#"===a.charAt(0))a=a.substring(1);else if("!"===a.charAt(0))a=a.substring(1);else if("/"===a.charAt(0))a=
a.substring(1);else if("%21"===a.substring(0,3))a=a.substring(3);else if("/"===a.charAt(a.length-1))a=a.substring(0,a.length-1);else break;return a};b.prototype.cachePath=b.cachePath;b.prototype.photoHash=b.photoHash;b.prototype.albumHash=b.albumHash;b.prototype.photoPath=b.photoPath;b.prototype.originalPhotoPath=b.originalPhotoPath;b.prototype.trimExtension=b.trimExtension;b.prototype.cleanHash=b.cleanHash;window.PhotoFloat=b})();
